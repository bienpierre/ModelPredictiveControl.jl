var documenterSearchIndex = {"docs":
[{"location":"MPC/#Model-Predictive-Control","page":"Model Predictive Control","title":"Model Predictive Control","text":"","category":"section"},{"location":"MPC/#Building-MPC-problems","page":"Model Predictive Control","title":"Building MPC problems","text":"","category":"section"},{"location":"MPC/","page":"Model Predictive Control","title":"Model Predictive Control","text":"EasyMPC provides linear Model Predictive Control formualtion.","category":"page"},{"location":"functions/#Functions-user-guide","page":"Functions user guide","title":"Functions user guide","text":"","category":"section"},{"location":"functions/","page":"Functions user guide","title":"Functions user guide","text":"This section describes functions references.","category":"page"},{"location":"functions/","page":"Functions user guide","title":"Functions user guide","text":"ModelPredictiveControl.mpc_problem\nModelPredictiveControl.linear_mpc\nModelPredictivecontrol.solve_mpc\nModelPredictiveControl.terminal_weight","category":"page"},{"location":"functions/","page":"Functions user guide","title":"Functions user guide","text":"MpcProblem","category":"page"},{"location":"functions/","page":"Functions user guide","title":"Functions user guide","text":"MpcProblem()","category":"page"},{"location":"style_guide/#Style-guide","page":"Style guide","title":"Style guide","text":"","category":"section"},{"location":"style_guide/","page":"Style guide","title":"Style guide","text":"JuMP style guide.","category":"page"},{"location":"Examples/QTP/#Four-tank-benchmark","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"The four tank benchmark also known as the Quadruple Tank Porcess (QTP) is a toy system devoted to display regulators capabilities in control engineering. Here the QTP is used to show ModelPredictiveControl.jl to design a linear MPC controller.","category":"page"},{"location":"Examples/QTP/#Process","page":"Four-tank benchmark","title":"Process","text":"","category":"section"},{"location":"Examples/QTP/#Program","page":"Four-tank benchmark","title":"Program","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"### QTP Example ###\n\nusing ModelPredictiveControl\nusing DifferentialEquations\nusing Plots\nusing LinearAlgebra\n\n### QTP with DifferentialEquation.jl\na1      = 1.31e-4; #m²\na2      = 1.51e-4; #m²\na3      = 9.27e-5; #m²\na4      = 8.82e-5; #m²\nS       = 0.06; #m\ng       = 9.81; #m²/s\ngamma_a = 0.3;\ngamma_b = 0.4;\n\nqa = 0; #m3/h\nqb = 0; #m3/h\n\nfunction QTP(dh, h, p, t)\n    dh[1] = -a1 / S * sqrt(2 * g * h[1]) + a3 / S * sqrt(2 * g * h[3]) + gamma_a / S * qa / 3600;\n    dh[2] = -a2 / S * sqrt(2 * g * h[2]) + a4 / S * sqrt(2 * g * h[4]) + gamma_b / S * qb / 3600;\n    dh[3] = -a3 / S * sqrt(2 * g * h[3]) + (1 - gamma_b) * qb / (3600 * S);\n    dh[4] = -a4 / S * sqrt(2 * g * h[4]) + (1 - gamma_a) * qa / (3600 * S);\n end\n\ntspan = (0.0,60.0);\ntsteps = range(tspan[1], tspan[2], step = 0.1);\nu0 = [0.68; 0.68; 0.68; 0.68];\nprob = ODEProblem(QTP,u0,tspan);\nsol = solve(prob, BS3(), saveat = tsteps);\n\nplot(sol)\n\n### Design the MPC controller to regulate the water level\n\nxl = [0.65;0.66;0.65;0.66]\nul = [1.63 ; 2.00]\n\nxcons = [0.2 1.36;\n         0.2 1.36;\n         0.2 1.30;\n         0.2 1.30] #m\n         \nucons = [0  3.26;\n         0  4] #m3/h\n\nTs = 5.0;#s\nmethod = \"l\"; #linear MPC\nQ =  Matrix(I, 4, 4)\nR = 0.01 *  Matrix(I, 2, 2)\nN = 15; #horizon length\n\n f((x1, x2, x3, x4, u1, u2)) = \n [ -a1 / S * sqrt(2 * g * x1) + a3 / S * sqrt(2 * g * x3) + gamma_a / S * u1 / 3600,\n   -a2 / S * sqrt(2 * g * x2) + a4 / S * sqrt(2 * g * x4) + gamma_b / S * u2 / 3600,\n   -a3 / S * sqrt(2 * g * x3) + (1 - gamma_b) * u2 / (3600 * S),\n   -a4 / S * sqrt(2 * g * x4) + (1 - gamma_a) * u1 / (3600 * S),\n ]\n\nRegulatorMPC = mpc_problem(f, xl, ul, xcons, ucons, Ts, method, Q, R, N)\n\nstate_reference = [0.3;0.3;0.301;0.306]\ninput_reference = [1.112;1.351]\n\n    RegulatorMPC.x_t = xl\n    RegulatorMPC.x_ref = state_reference .* ones(4, N+1)\n    RegulatorMPC.u_ref = input_reference .* ones(2,N)\n    println(\"toto\")\n    u, x, utilde, xtilde, objc = solve_mpc(RegulatorMPC)\n    \n\n\nobj = []\nfunction ctrl_cb(int)\n    x_meas = int.u\n    RegulatorMPC.x_t = convert(Vector{Float64}, x_meas)\n    RegulatorMPC.x_ref = state_reference .* ones(4, N+1)\n    RegulatorMPC.u_ref = input_reference .* ones(2,N)\n    u, x, utilde, xtilde, objc = solve_mpc(RegulatorMPC)\n    global qa = u[1,1]\n    global qb = u[2,1]\n    println(\"qa : $qa\")\n    println(\"qb : $qb\")\n    push!(obj, objc)\nend \n\npcb  = PeriodicCallback(ctrl_cb, 5.0)\n\n\ntspan = (0.0,1500.0);\ntsteps2 = range(tspan[1], tspan[2], step = 0.01);\n\nprob2 = ODEProblem(QTP,u0, tspan, callback = pcb);\n\n### Run the QTP problem with the regulator\nsol2 = DifferentialEquations.solve(prob2, Tsit5());\n\nplot(sol2)\nplot(obj)","category":"page"},{"location":"Examples/QTP/#Description","page":"Four-tank benchmark","title":"Description","text":"","category":"section"},{"location":"Examples/QTP/#Load-packages","page":"Four-tank benchmark","title":"Load packages","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"using ModelPredictiveControl\nusing DifferentialEquations\nusing Plots\nusing LinearAlgebra","category":"page"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"DifferentialEquations is used to compute simulation of the QTP.","category":"page"},{"location":"Examples/QTP/#QTP-simulation","page":"Four-tank benchmark","title":"QTP simulation","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"### QTP with DifferentialEquation.jl\na1      = 1.31e-4; #m²\na2      = 1.51e-4; #m²\na3      = 9.27e-5; #m²\na4      = 8.82e-5; #m²\nS       = 0.06; #m\ng       = 9.81; #m²/s\ngamma_a = 0.3;\ngamma_b = 0.4;\n\nqa = 0; #m3/h\nqb = 0; #m3/h\n\nfunction QTP(dh, h, p, t)\n    dh[1] = -a1 / S * sqrt(2 * g * h[1]) + a3 / S * sqrt(2 * g * h[3]) + gamma_a / S * qa / 3600;\n    dh[2] = -a2 / S * sqrt(2 * g * h[2]) + a4 / S * sqrt(2 * g * h[4]) + gamma_b / S * qb / 3600;\n    dh[3] = -a3 / S * sqrt(2 * g * h[3]) + (1 - gamma_b) * qb / (3600 * S);\n    dh[4] = -a4 / S * sqrt(2 * g * h[4]) + (1 - gamma_a) * qa / (3600 * S);\n end\n\ntspan = (0.0,60.0);\ntsteps = range(tspan[1], tspan[2], step = 0.1);\nu0 = [0.68; 0.68; 0.68; 0.68];\nprob = ODEProblem(QTP,u0,tspan);\nsol = solve(prob, BS3(), saveat = tsteps);\n\nplot(sol)","category":"page"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"QTP parameters are displayed. Then the system is simulated. Result shows that in order to regulate tank water level pumps flow need to be greater than 0.","category":"page"},{"location":"Examples/QTP/#Design-a-linear-MPC-regulator","page":"Four-tank benchmark","title":"Design a linear MPC regulator","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"### Design the MPC controller to regulate the water level\n\nxl = [0.65;0.66;0.65;0.66]\nul = [1.63 ; 2.00]\n\nxcons = [0.2 1.36;\n         0.2 1.36;\n         0.2 1.30;\n         0.2 1.30] #m\n         \nucons = [0  3.26;\n         0  4] #m3/h\n\nTs = 5.0;#s\nmethod = \"l\"; #linear MPC\nQ =  Matrix(I, 4, 4)\nR = 0.01 *  Matrix(I, 2, 2)\nN = 15; #horizon length\n\n f((x1, x2, x3, x4, u1, u2)) = \n [ -a1 / S * sqrt(2 * g * x1) + a3 / S * sqrt(2 * g * x3) + gamma_a / S * u1 / 3600,\n   -a2 / S * sqrt(2 * g * x2) + a4 / S * sqrt(2 * g * x4) + gamma_b / S * u2 / 3600,\n   -a3 / S * sqrt(2 * g * x3) + (1 - gamma_b) * u2 / (3600 * S),\n   -a4 / S * sqrt(2 * g * x4) + (1 - gamma_a) * u1 / (3600 * S),\n ]\n\nRegulatorMPC = mpc_problem(f, xl, ul, xcons, ucons, Ts, method, Q, R, N)","category":"page"},{"location":"Examples/QTP/#Regulator-differential-equation-solve","page":"Four-tank benchmark","title":"Regulator + differential equation solve","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"state_reference = [0.3;0.3;0.301;0.306]\ninput_reference = [1.112;1.351]\n\n    RegulatorMPC.x_t = xl\n    RegulatorMPC.x_ref = state_reference .* ones(4, N+1)\n    RegulatorMPC.u_ref = input_reference .* ones(2,N)\n    println(\"toto\")\n    u, x, utilde, xtilde, objc = solve_mpc(RegulatorMPC)\n    \n\n\nobj = []\nfunction ctrl_cb(int)\n    x_meas = int.u\n    RegulatorMPC.x_t = convert(Vector{Float64}, x_meas)\n    RegulatorMPC.x_ref = state_reference .* ones(4, N+1)\n    RegulatorMPC.u_ref = input_reference .* ones(2,N)\n    u, x, utilde, xtilde, objc = solve_mpc(RegulatorMPC)\n    global qa = u[1,1]\n    global qb = u[2,1]\n    println(\"qa : $qa\")\n    println(\"qb : $qb\")\n    push!(obj, objc)\nend \n\npcb  = PeriodicCallback(ctrl_cb, 5.0)\n\n\ntspan = (0.0,1500.0);\ntsteps2 = range(tspan[1], tspan[2], step = 0.01);\n\nprob2 = ODEProblem(QTP,u0, tspan, callback = pcb);","category":"page"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"Here the regulator is called during simulation with DifferentialEquation callback and PeriodicCallback. At each 5 seconds, the ctrl_cb is called, measure, state and input references are updated within the Regulator and the MPC is solved. Finally, inputs computed are sent to pumps qa and qb.","category":"page"},{"location":"Examples/QTP/#Solving","page":"Four-tank benchmark","title":"Solving","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"Finally, the linear MPC regulator and the simulation are simulated with the folowing:","category":"page"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"### Run the QTP problem with the regulator\nsol2 = DifferentialEquations.solve(prob2, Tsit5());\n\nplot(sol2)\nplot(obj)","category":"page"},{"location":"Examples/QTP/#Expected-output","page":"Four-tank benchmark","title":"Expected output","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"When running the program expected output are:","category":"page"},{"location":"Examples/QTP/#Reference","page":"Four-tank benchmark","title":"Reference","text":"","category":"section"},{"location":"Examples/QTP/","page":"Four-tank benchmark","title":"Four-tank benchmark","text":"[1] Alvarado, I., Limon, D., De La Peña, D. M., Maestre, J. M., Ridao, M. A., Scheu, H., ... & Espinosa, J. (2011). A comparative analysis of distributed MPC techniques applied to the HD-MPC four-tank benchmark. Journal of Process Control, 21(5), 800-815.","category":"page"},{"location":"linearmpc/#Linear-Model-Predictive-Control","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"","category":"section"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"ModelPredictiveControl.jl provides linear Model Predictive Control formulation.","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"undersettextbfu textmin\ntildex_N P tildex_N + displaystylesum_k=0^N-1 tildex_k Q tildex_k + tildeu_k R tildeu_k \ntextnormalst    tildex_k+1 =  Atildex_k + Btildeu_k \ntildex_k = x_k - x^r \ntildeu_k = u_k - u^r \nx_k in mathcalX \nu_k in mathcalU \nx_0 = barx(t) ","category":"page"},{"location":"linearmpc/#Basics","page":"Linear Model Predictive Control","title":"Basics","text":"","category":"section"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"julia> controller = mpc_problem(f, xl, ul, x_cons, u_cons, Ts, method, Q, R, N)\n","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"Where f is the non-linear dynamical system, xl and ul are the state and input linearised point, xcons and ucons are the state and input constraints, Ts is the sample time, method is the controller method, for a linear MPC \"l\", Q and R are the weighting matrices with appropriate dimensions, N is the horizon length.","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"It is also possible to design a regulator with a discrete state-space linear system:","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"julia> controller = linear_mpc(Ad, Bd, xcons, ucons, Q, R, P, N)","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"Where Ad and Bd are the state and input matrices of the linear system, xcons and ucons are the state and input constraints, Q, R and P are the weighting matrices with appropriate dimensions, N is the horizon length.","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"Here the regulator is a composite with ","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"mutable struct Regulator\n    formulation\n    x_t\n    x_ref\n    u_ref\n    method\nend","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"Where controller is the JuMP model design, xt the states measurement, xref and uref are the states and inputs references, method is the controller MPC method, \"l\" for a linear MPC.","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"Then the MPC can be solved, however mesurement and references have to be filled in.","category":"page"},{"location":"linearmpc/","page":"Linear Model Predictive Control","title":"Linear Model Predictive Control","text":"julia> controller.x_t = state measurement\njulia> controller.x_ref = state reference\njulia> controller.u_ref = input reference\njulia> x, u = solve_mpc(controller)","category":"page"},{"location":"Examples/mass-string-damper/#Mass-Spring-Damper-system","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"","category":"section"},{"location":"Examples/mass-string-damper/","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"Consider a mass-string-damper system. The state space model is equal to:","category":"page"},{"location":"Examples/mass-string-damper/","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"dotx(t) = \nbeginbmatrix 0  1 \n\t\t\t\t-frackm  - fracbm\nendbmatrix\n\t\t x(t) + \nbeginbmatrix\n0 \nfrac1m\nendbmatrix\n\t\t u(t)","category":"page"},{"location":"Examples/mass-string-damper/","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"Where, m is the mass in kg, k is the spring constant in   Nm, b is the damping constant in Nsm and u the input force in N.","category":"page"},{"location":"Examples/mass-string-damper/","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"m = 10 kg \nk = 10 Nm \nb = 02 Nsm ","category":"page"},{"location":"Examples/mass-string-damper/#Process","page":"Mass-Spring Damper system","title":"Process","text":"","category":"section"},{"location":"Examples/mass-string-damper/#Program","page":"Mass-Spring Damper system","title":"Program","text":"","category":"section"},{"location":"Examples/mass-string-damper/#Description","page":"Mass-Spring Damper system","title":"Description","text":"","category":"section"},{"location":"Examples/mass-string-damper/#Load-packages","page":"Mass-Spring Damper system","title":"Load packages","text":"","category":"section"},{"location":"Examples/mass-string-damper/#Reference","page":"Mass-Spring Damper system","title":"Reference","text":"","category":"section"},{"location":"Examples/mass-string-damper/","page":"Mass-Spring Damper system","title":"Mass-Spring Damper system","text":"[1] online https://ctms.engin.umich.edu/CTMS/index.php?example=Introduction&section=SystemModeling","category":"page"},{"location":"Examples/#Examples","page":"Examples","title":"Examples","text":"","category":"section"},{"location":"Examples/","page":"Examples","title":"Examples","text":"This section of the documentation describes MPC regulators using EasyMPC for engineering applications.","category":"page"},{"location":"#Model-Predictive-Control-design-facilitor","page":"Home","title":"Model Predictive Control design facilitor","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The package provides Model Predictive Control design for engineering applications. Itis in early stage, please consider the package as experimental. ","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"#Acknowledgements","page":"Home","title":"Acknowledgements","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"ModelPredictiveControl.jl is available thanks to valuable Julia package ecosystem JuMP.jl, OSQP.jl, Controlsystems.jl, LinearAlgebra.jl, ForwardDiff.jl.","category":"page"},{"location":"tools/#Tools","page":"Tools","title":"Tools","text":"","category":"section"},{"location":"tools/","page":"Tools","title":"Tools","text":"Tools related to MPC are depicted in this section.","category":"page"},{"location":"tools/#Terminal-matrix-computation","page":"Tools","title":"Terminal matrix computation","text":"","category":"section"},{"location":"tools/","page":"Tools","title":"Tools","text":"julia> P = terminal_weight(Ad, Bd, Q, R)\n","category":"page"},{"location":"tools/","page":"Tools","title":"Tools","text":"P is computed thanks to Discrete Algebraic Riccati Equation. Where Ad and Bd are the discrete state and input matrices, Q and R are the weighting matrices with appropriate dimensions.","category":"page"}]
}
